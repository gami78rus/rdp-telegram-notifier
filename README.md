Мониторинг RDP-подключений с отправкой уведомлений в Telegram
Данный репозиторий содержит PowerShell-скрипт для отслеживания событий входа и переподключения по протоколу RDP на компьютерах под управлением Windows и отправки детализированных оповещений в чат или группу Telegram.
Основные функции
•	Мониторинг событий входа (Event ID 21) и повторного подключения (Event ID 25) по RDP.
•	Отправка структурированных уведомлений в заданный чат или группу Telegram.
•	Состав уведомления:
o	Полное доменное имя (FQDN) хоста.
o	Все IPv4-адреса хоста.
o	Учетная запись пользователя, выполнившего вход.
o	IP-адрес клиента, с которого выполнено подключение.
o	DNS-имя клиентского IP-адреса (при возможности разрешения).
o	Тип события (Вход/Повторное подключение).
o	Идентификатор события (Event ID).
o	Временная метка события.
o	Полное сообщение из журнала событий.
•	Автоматическая установка в качестве запланированной задачи, выполняемой при входе в систему.
•	Реализация в виде единого PowerShell-скрипта для упрощения развертывания.
Инструкция по использованию
1.	Получение токена бота Telegram
o	Обратитесь к боту @BotFather в Telegram.
o	Используйте команду /newbot для создания нового бота.
o	Следуйте инструкциям, укажите имя и имя пользователя (username) для бота.
o	Сохраните предоставленный API-токен (например, 123456789:ABC-DEF1234ghy).
2.	Получение идентификатора чата (Chat ID)
o	Для личного чата: Отправьте любое сообщение созданному боту. Затем перешлите это сообщение боту @RawDataBot или @myidbot, чтобы получить идентификатор чата.
o	Для группового чата: Добавьте бота в группу, отправьте сообщение в группу. Затем добавьте в группу бота @RawDataBot или @myidbot, который отобразит идентификатор группы (отрицательное число, например, -123456789).
3.	Настройка скрипта
o	Откройте файл install-monitoring.template.ps1 в текстовом редакторе.
o	Найдите в коде скрипта следующие переменные:
powershell
$BotToken = "ВАШ_ТЕЛЕГРАМ_БОТ_ТОКЕН"
$ChatID = "ВАШ_ID_ЧАТА_ИЛИ_ГРУППЫ"
o	Замените значение ВАШ_ТЕЛЕГРАМ_БОТ_ТОКЕН на токен, полученный от BotFather.
o	Замените значение ВАШ_ID_ЧАТА_ИЛИ_ГРУППЫ на полученный идентификатор чата.
4.	Запуск на целевых компьютерах
o	Скопируйте измененный файл install-monitoring.template.ps1 на каждый компьютер Windows, где требуется мониторинг RDP-подключений.
o	На целевом компьютере выполните скрипт с повышенными привилегиями. Для этого запустите PowerShell или командную строку от имени администратора, перейдите в каталог со скриптом и выполните команду:
powershell
powershell.exe -ExecutionPolicy Bypass -File .\install-monitoring.template.ps1
o	Скрипт автоматически запросит права администратора при необходимости, установит кодировку вывода UTF-8, создаст необходимые файлы (monitor-rdp.ps1, send-telegram.ps1, log.txt) в каталоге C:\ProgramData\TelegramNotifications и создаст запланированную задачу TelegramRDPAlert для запуска основного скрипта мониторинга при каждом входе в систему.
Принцип работы
Основной скрипт установки (install-monitoring.template.ps1) включает в себя два вспомогательных скрипта:
•	monitor-rdp.ps1 — выполняет постоянный мониторинг журнала событий Windows "Безопасность" на предмет событий входа (ID 21) и повторного подключения (ID 25) по RDP. Извлекает релевантную информацию: имя пользователя, исходный IP-адрес, данные хоста.
•	send-telegram.ps1 — принимает текст сообщения и отправляет его в заданный чат Telegram через Bot API с использованием командлета Invoke-RestMethod.
Скрипт monitor-rdp.ps1 запускается запланированной задачей при каждом входе в систему, что обеспечивает непрерывный мониторинг. Для диагностики ведется лог-файл C:\ProgramData\TelegramNotifications\log.txt.
как-то плохо, я вставлю и все не очень нормально выгядит.. сДЕЛАЙ чтобы было все круто и я скопировал
МОНИТОРИНГ RDP-ПОДКЛЮЧЕНИЙ С ОТПРАВКОЙ УВЕДОМЛЕНИЙ В TELEGRAM
Данный репозиторий содержит PowerShell-скрипт для мониторинга событий входа и переподключения по протоколу RDP на компьютерах Windows с отправкой детализированных оповещений в Telegram.
________________________________________
ОСНОВНЫЕ ВОЗМОЖНОСТИ
•	Мониторинг событий RDP: Отслеживание входа (Event ID 21) и повторного подключения (Event ID 25)
•	Telegram-уведомления: Отправка структурированных оповещений в указанный чат или группу
•	Детализация уведомлений:
o	Полное доменное имя (FQDN) хоста
o	Все IPv4-адреса хоста
o	Учетная запись пользователя
o	IP-адрес клиента-источника
o	DNS-имя клиентского IP (при возможности разрешения)
o	Тип события (Вход/Повторное подключение)
o	Идентификатор события (Event ID)
o	Временная метка события
o	Полное сообщение из журнала событий
•	Автоматическое развертывание: Установка как запланированной задачи, выполняемой при входе в систему
•	Простота использования: Единый скрипт для развертывания
________________________________________
ИНСТРУКЦИЯ ПО УСТАНОВКЕ И НАСТРОЙКЕ
1. Получение токена бота Telegram
1.	Найдите @BotFather в Telegram
2.	Отправьте команду /newbot
3.	Следуйте инструкциям для создания бота
4.	Сохраните полученный API-токен (формат: 123456789:ABC-DEF1234ghy)
2. Получение идентификатора чата (Chat ID)
•	Для личного чата: Отправьте сообщение боту, затем перешлите это сообщение @RawDataBot
•	Для группового чата: Добавьте бота в группу, отправьте сообщение, затем добавьте @RawDataBot в ту же группу
3. Настройка скрипта
Откройте файл install-monitoring.template.ps1 и замените значения:
powershell
$BotToken = "ВАШ_ТЕЛЕГРАМ_БОТ_ТОКЕН"
$ChatID = "ВАШ_ID_ЧАТА_ИЛИ_ГРУППЫ"
4. Запуск на целевых компьютерах
Скопируйте настроенный скрипт на каждый компьютер и выполните:
powershell
powershell.exe -ExecutionPolicy Bypass -File .\install-monitoring.template.ps1
Результат выполнения:
•	Создание каталога C:\ProgramData\TelegramNotifications
•	Размещение скриптов monitor-rdp.ps1 и send-telegram.ps1
•	Создание лог-файла log.txt
•	Регистрация запланированной задачи TelegramRDPAlert
________________________________________
АРХИТЕКТУРА РЕШЕНИЯ
text
install-monitoring.template.ps1
├── monitor-rdp.ps1        # Мониторинг журнала событий Windows
│   ├── Фильтрация Event ID 21, 25
│   ├── Извлечение данных о подключении
│   └── Логирование в log.txt
└── send-telegram.ps1      # Отправка сообщений через Bot API
    └── Использование Invoke-RestMethod
________________________________________
ПРЕИМУЩЕСТВА ДЛЯ ИНФОРМАЦИОННОЙ БЕЗОПАСНОСТИ
•	Соответствие требованиям: Помогает выполнять требования по мониторингу удаленных подключений
•	Оперативное реагирование: Мгновенное оповещение о подозрительных RDP-сессиях
•	Аудит и учет: Детальная информация о каждом подключении для последующего анализа
•	Простота интеграции: Может быть расширен для интеграции с SIEM-системами
________________________________________
ТРЕБОВАНИЯ
•	Windows 7/8/10/11 или Windows Server 2008R2 и выше
•	PowerShell 3.0 или выше
•	Права администратора для установки
•	Доступ к API Telegram
________________________________________
Примечание: Решение предназначено для легитимного мониторинга собственной инфраструктуры. Убедитесь в наличии необходимых разрешений для развертывания на целевых системах.

